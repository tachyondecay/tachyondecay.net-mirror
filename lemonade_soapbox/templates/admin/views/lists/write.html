{% extends 'admin/layouts/write.html' %}

{% block page_title %}
{% if post.title %}Editing “{{ post.title }}”{% else %}Creating a new list{% endif %} {{ super() }}
{% endblock %}

{% block field__title %}
<label for="title" class="_hide">List Title</label>
{{ form.title(**{'aria-label': 'Title', 'class': 'textinput -blend -title', 'placeholder': 'List title…', 'autocomplete': 'off'}) }}
{% endblock %}


{% block post_contents %}
	{{ super() }}

    <div class="form-field">
        <label>List Items</label>
    	<ol class="results-list js-sortable">
            {% for item in post.items %}
                <li>
                    {{ form.items[loop.index0].list_id }}
                    {{ form.items[loop.index0].post_id }}
                    {{ form.items[loop.index0].position }}
                    <span class="i--{{ 'book' if item.post.post_type == 'review' else 'newspaper'}} icon"></span>
                    <a href="{{ item.post.get_editlink() }}" target="_blank">{{ item.post.title }}</a>
                    {{ form.items[loop.index0].blurb(placeholder="Add blurb…") }}
                </li>
            {% endfor %}
        </ol>
        <div class="quick-search">
            <input type="text" class="quicksearch" id="quicksearch" placeholder="Add post to list…" autocomplete="off">
            <div class="results"></div>
            <script type="x-tmpl-mustache">
                <div class="resultitem -<%type%>" data-edit-link="<% edit %>" data-post-id="<% id %>">
                    <strong class="addtolist" title="<% full_title %>"><% title %></strong>
                </div>
            </script>
        </div>
        <script id="list-item-prototype" type="x-tmpl-mustache">
            <li>
                <input type="hidden" name="items-<% num %>-list_id" value="<% list_id %>">
                <input type="hidden" name="items-<% num %>-post_id" value="<% post_id %>">
                <input type="text" name="items-<% num %>-position" value="<% num %>">
                <span class="i--<% icon %> icon"></span>
                <a href="<% editlink %>" target="_blank"><% title %></a>
                <textarea class="" name="items-<% num %>-blurb" placeholder="Add blurb…"></textarea>
            </li>
        </script>
    </div>
{% endblock post_contents %}


{% block post_metadata %}
    <div class="form-field -span upload-widget js-image-upload" data-alt="Pasted list image">
        {{ form.pasted_cover }}
        <div class="fileselect">
            {{ render_field(form.cover, label='List Cover') }}
        </div>
        <div class="thumbnail-preview">
            {% if post.cover %}
            <img src="/media/lists/covers/{{ post.cover }}" class="thumbnail" alt="Cover image" />
            {% else %}
            <img src="" class="thumbnail -none" alt="" />
            {% endif %}
            <div class="placeholder">Paste image here</div>
        </div>

        <div class="remove">
            {{ checkbox_toggle(form.remove_cover, size='small') }}
        </div>
    </div>

        {{ checkbox_toggle(form.show_numbers, label='Show numbers') }}

        {{ checkbox_toggle(form.reverse_order, label='Descending order') }}

    {{ super() }}
 {% endblock post_metadata %}